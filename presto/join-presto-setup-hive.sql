
!echo # join-presto-data-setup-hive.sql;

USE default;
DROP DATABASE IF EXISTS benchmark CASCADE;
CREATE DATABASE benchmark COMMENT 'part of H2O h2oai/db-benchmark';
USE benchmark;

!echo ${SRC_X_DIR};
!echo ${SRC_Y_DIR};

!echo hive-out-data-setup-body;

CREATE EXTERNAL TABLE src_x (KEY BIGINT, X2 BIGINT)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ","
STORED AS TEXTFILE
LOCATION "${SRC_X_DIR}"
TBLPROPERTIES('skip.header.line.count'='1')
;

CREATE EXTERNAL TABLE src_y (KEY BIGINT, Y2 BIGINT)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ","
STORED AS TEXTFILE
LOCATION "${SRC_Y_DIR}"
TBLPROPERTIES('skip.header.line.count'='1')
;

CREATE TABLE IF NOT EXISTS x (KEY BIGINT, X2 BIGINT)
STORED AS ORC
TBLPROPERTIES("orc.compress"="SNAPPY");

CREATE TABLE IF NOT EXISTS y (KEY BIGINT, Y2 BIGINT)
STORED AS ORC
TBLPROPERTIES("orc.compress"="SNAPPY");

INSERT OVERWRITE TABLE x SELECT * FROM src_x;
INSERT OVERWRITE TABLE y SELECT * FROM src_y;

!echo hive-out-data-setup-body;

CREATE TABLE x_count AS SELECT COUNT(*) in_rows FROM x;
CREATE TABLE y_count AS SELECT COUNT(*) in_rows FROM y;

EXIT;
